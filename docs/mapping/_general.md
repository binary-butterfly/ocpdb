# OCPDB mapping

The OCPDB maps various data sources in various formats to OCPI 2.2.1 objects. This document describes general 
considerations, which are valid for all mappers.

## Sources

The OCPDB introduces the non-OCPI entity 'source', which represents a specific data source. This is necessary, because
we want to store additional metadata, and as our data sources are not always OCPI 2.2.1, the
[OCPI hub mechanism](https://github.com/ocpi/ocpi/blob/release-2.2.1-bugfixes/topology.asciidoc#platforms-via-hub) will
not work properly.

There are a few fields which are mapped to the source. Usually, this data is provided by the `SourceInfo` class.

* name: The name of the source
* public_url: A public URL of the source for more information
* attribution_license: The name of the licence which is used for the data of this source
* attribution_contributor: Contributors which should be named as part of the licence link
* attribution_url: An URL where the licence should link to


## id / uid mapping

OCPI requires unique identifiers at multiple objects. As we have multiple sources, we cannot guarantee the uniqueness
with unique identifiers in scope of the source, as multiple sources can use the same unique identifier.
Therefore, we introduce our own identifiers, and store the unique identifier of the source at `original_{field}`.

In case of an OCPI data source, this ends up in following fields:

### Location

| Field | Type    | Cardinality | Mapping              | Comment            |
|-------|---------|-------------|----------------------|--------------------|
| id    | string  | 1           | location.original_id |                    |
|       | string  | 1           | location.id          | Generated by OCPDB |


### EVSE

| Field | Type    | Cardinality | Mapping           | Comment            |
|-------|---------|-------------|-------------------|--------------------|
| uid   | string  | 1           | evse.original_uid |                    |
|       | string  | 1           | evse.uid          | Generated by OCPDB |


### Connector

| Field | Type    | Cardinality | Mapping               | Comment            |
|-------|---------|-------------|-----------------------|--------------------|
| id    | string  | 1           | connector.original_id |                    |
|       | string  | 1           | connector.iid         | Generated by OCPDB |


## Location data

As OCPI enforces a maximum of seven digits after the comma, the OCPDB caps all latitudes and longitudes at `Location` 
and `EVSE` objects to seven digits after the comma. For further details about the OCPI regular expression for location
data, please have a look at the 
[OCPI specification](https://github.com/ocpi/ocpi/blob/release-2.2.1-bugfixes/mod_locations.asciidoc#mod_locations_geolocation_class).
